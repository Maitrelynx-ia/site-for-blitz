<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Profil - World of Tanks Blitz</title>
  <style>
  /* Global Styles */
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  margin: 0;
  background-color: #1e1e1e;
  color: #e0e0e0;
}

header {
  background-color: #000000;
  padding: 1em;
}

nav {
  display: flex;
  justify-content: center;
  gap: 1em;
}

nav a {
  color: #58a6ff;
  text-decoration: none;
  font-weight: bold;
}

nav a:hover {
  text-decoration: underline;
}

footer {
  background-color: #1e1e1e;
  color: #b0b0b0;
  padding: 1em;
  text-align: center;
}

h1, h2 {
  color: #e0e0e0;
}

h2 {
  border-bottom: 2px solid #30363d;
  padding-bottom: 0.5em;
}

ul {
  list-style: none;
  padding: 0;
}

li {
  margin: 0.5em 0;
}

.profile-section {
  max-width: 800px;
  margin: auto;
  padding: 2em;
  background-color: #2b2b2b;
  border-radius: 10px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
}

#profile-header {
  display: flex;
  align-items: center;
  gap: 1em;
  margin-bottom: 2em;
}

.avatar {
  width: 100px;
  height: 100px;
  border-radius: 50%;
}

#player-name {
  font-size: 1.5em;
  margin: 0;
  color: #58a6ff;
}

#player-tank {
  color: #a0a0a0;
}

.stats ul {
  padding: 0;
}

.stats li {
  font-size: 1.1em;
  color: #dcdcdc;
}

button {
  background-color: #238636;
  color: white;
  padding: 0.7em;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-size: 1em;
}

button:hover {
  background-color: #2ea043;
}

.replays, .tips {
  background-color: #2b2b2b;
  padding: 1.5em;
  border-radius: 10px;
  margin-top: 2em;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
}

footer p {
  margin: 0;
}

  </style> 
</head>
<body>
  <header>
    <h1>Mon Profil</h1>
    <nav>
    <div style="flex-grow: 1;">
      <a href="../index.html">Accueil</a>
      <a href="profile.html">Profil</a>
      <a href="share.html">Partager</a>
      <a href="search.html"> Recherche</a>
      <a href="donate.html">Faire un don</a>
      <a id="login-logout" href="login.html">Se connecter</a>
    </div>
  </nav>
  </header>
  <main class="centered">
    <section class="profile-section">
      <h1>Mon Profil</h1>

      <div id="profile-header">
        <img src="https://via.placeholder.com/100" alt="Avatar" class="avatar" id="avatar" />
        <div>
          <h2 id="player-name">Nom du joueur</h2>
          <p id="player-tank">Le tank préféré : T-34</p>
        </div>
      </div>

      <section class="stats">
        <h2>Statistiques de performance</h2>
        <ul>
          <li><strong>Batailles :</strong> <span id="battles">0</span></li>
          <li><strong>Taux de victoire (30 jours) :</strong> <span id="win-rate">0%</span></li>
          <li><strong>Taux de survie :</strong> <span id="survival-rate">0%</span></li>
          <li><strong>XP moyen :</strong> <span id="avg-xp">0</span></li>
          <li><strong>Max XP :</strong> <span id="max-xp">0</span></li>
          <li><strong>Victoires moyennes / bataille :</strong> <span id="avg-wins-per-battle">0</span></li>
          <li><strong>Nombre moyen de morts / morts :</strong> <span id="avg-deaths-per-battle">0</span></li>
          <li><strong>Points / bataille moyens :</strong> <span id="avg-points-per-battle">0</span></li>
          <li><strong>Dégâts moyens :</strong> <span id="avg-damage">0</span></li>
          <li><strong>Dmg / Shot :</strong> <span id="dmg-per-shot">0</span></li>
          <li><strong>Dmg / Hit :</strong> <span id="dmg-per-hit">0</span></li>
          <li><strong>Capture de la base moyenne :</strong> <span id="base-capture">0%</span></li>
          <li><strong>Défense de la base moyenne :</strong> <span id="base-defense">0%</span></li>
          <li><strong>Dommages accordés / reçus :</strong> <span id="damage-done-received">0%</span></li>
          <li><strong>Taux de succès :</strong> <span id="success-rate">0%</span></li>
          <li><strong>Tanks possédés :</strong> <span id="tanks-owned">0</span></li>
          <li><strong>Insignes de maîtrise (As) :</strong> <span id="mastery-badges">0</span></li>
        </ul>
      </section>

      <section class="replays">
        <h2>Replays récents</h2>
        <ul id="replay-list">
          <!-- Les replays s'affichent ici -->
          <li>Aucun replay disponible.</li>
        </ul>
      </section>

      <section class="tips">
        <h2>Astuces</h2>
        <ul id="tip-list">
          <!-- Les astuces s'affichent ici -->
          <li>Aucune astuce partagée.</li>
        </ul>
      </section>
    </section>
  </main>
  <script>
    document.addEventListener('DOMContentLoaded', async function() {
  // Si l'utilisateur est connecté, récupérer ses données et les afficher
  const playerName = localStorage.getItem('playerName'); // Utilisation du localStorage pour stocker le pseudo

  if (playerName) {
    document.getElementById('player-name').textContent = playerName;
    // Appeler l'API pour récupérer les statistiques du joueur
    try {
      const response = await fetch(`/api/player/${playerName}`);
      const data = await response.json();

      if (response.ok) {
        // Afficher les statistiques du joueur
        document.getElementById('battles').textContent = data.stats.battles || 0;
        document.getElementById('win-rate').textContent = data.stats.win_rate + '%';
        document.getElementById('survival-rate').textContent = data.stats.survival_rate + '%';
        document.getElementById('avg-xp').textContent = data.stats.avg_xp || 0;
        document.getElementById('max-xp').textContent = data.stats.max_xp || 0;
        document.getElementById('avg-wins-per-battle').textContent = data.stats.avg_wins_per_battle || 0;
        document.getElementById('avg-deaths-per-battle').textContent = data.stats.avg_deaths_per_battle || 0;
        document.getElementById('avg-points-per-battle').textContent = data.stats.avg_points_per_battle || 0;
        document.getElementById('avg-damage').textContent = data.stats.avg_damage || 0;
        document.getElementById('dmg-per-shot').textContent = data.stats.dmg_per_shot || 0;
        document.getElementById('dmg-per-hit').textContent = data.stats.dmg_per_hit || 0;
        document.getElementById('base-capture').textContent = data.stats.base_capture || 0;
        document.getElementById('base-defense').textContent = data.stats.base_defense || 0;
        document.getElementById('damage-done-received').textContent = data.stats.damage_done_received || 0;
        document.getElementById('success-rate').textContent = data.stats.success_rate + '%';
        document.getElementById('tanks-owned').textContent = data.stats.tanks_owned || 0;
        document.getElementById('mastery-badges').textContent = data.stats.mastery_badges || 0;

        // Afficher l'avatar
        document.getElementById('avatar').src = data.avatar_url;

        // Replays de l'utilisateur
        const replayList = document.getElementById('replay-list');
        if (data.replays.length > 0) {
          data.replays.forEach(replay => {
            const li = document.createElement('li');
            li.textContent = replay.title;  // Assurez-vous que chaque objet 'replay' possède une propriété 'title'
            replayList.appendChild(li);
          });
        } else {
          replayList.innerHTML = '<li>Aucun replay disponible.</li>';
        }

        // Astuces de l'utilisateur
        const tipList = document.getElementById('tip-list');
        if (data.tips.length > 0) {
          data.tips.forEach(tip => {
            const li = document.createElement('li');
            li.textContent = tip.title; // Assurez-vous que chaque objet 'tip' possède une propriété 'title'
            tipList.appendChild(li);
          });
        } else {
          tipList.innerHTML = '<li>Aucune astuce partagée.</li>';
        }
      } else {
        alert('Erreur de récupération des données');
      }
    } catch (error) {
      console.error('Erreur:', error);
      alert('Erreur lors de la récupération des données');
    }
  } else {
    alert('Utilisateur non connecté');
    window.location.href = 'login.html';  // Rediriger l'utilisateur vers la page de connexion
  }
});
  </script>
</body>
</html>
